---
title: コード品質チェックツール
description: monorepoで使用される静的解析・整形・スペルチェックなどの品質向上ツール群について解説します。
sidebar_position: 9
---

## 9 開発時のコード品質チェックツール

本章では、プロジェクト内で使用されている**コード品質を保つために使用される各種ツールの役割と、プロジェクト内での運用方法**について解説します。

各ツールは `package.json` のスクリプトと連動し、ローカル開発・Git フック・CI の各段階でコードの品質維持に活用されています。

### 9.1 使用ツール一覧

以下の品質チェックツールを使って、プロジェクトの品質を維持しています。

<!-- markdownlint-disable line-length -->

| ツール         | 系統     | 目的                               | スクリプト                      | 備考                                                       |
| -------------- | -------- | ---------------------------------- | ------------------------------- | ---------------------------------------------------------- |
| `dprint`       | format   | コード、ドキュメントの整形         | `check:dprint`, `format:dprint` |                                                            |
| `CSpell`       | check    | スペルチェック                     | `check:spells`                  | ドキュメント、設定ファイルも対象                           |
| `tsc`          | check    | 型チェック (`--noEmit`)            | `check:types`                   | 型の破綻や未定義参照を検出するのに有効                     |
| `ESLint`       | lint     | コードの静的解析                   | `lint`, `lint:types`            | 静的解析によるエラーチェック、設定により型のチェックも可能 |
| `Vitest`       | test     | テスティングフレームワーク         | `test:develop`, `test:ci`       | 作成したテストを実行し、エラーチェックを行う               |
| `Secretlint`   | CI       | 機密情報スキャン                   | `lint:secrets`                  | パスワード、APIキーなどの漏洩防止用                        |
| `ls-lint`      | CI       | ファイル／ディレクトリ命名チェック | `lint:filename`                 | `kebab-case`, `camelCase` などの命名統一用                 |
| `markdownlint` | Document | マークダウンの構文チェック         | `lint:markdown`                 | マークダウンドキュメントの文法チェック                     |
| `textlint`     | Document | ドキュメントの表現ガイドライン検証 | `lint:text`                     |                                                            |

<!-- markdownlint-enable -->

### 9.2 ローカル実行

プログラミングやデバッグなどサブパッケージ内で完結する作業では、以下のように `pnpm run <script>` によって品質チェックできます。

| 実行スクリプト (`pnpm run <script>`) | ツール | チェックする品質                                 |
| ------------------------------------ | ------ | ------------------------------------------------ |
| `pnpm run lint`                      | ESLint | 作成したコードを解析しエラーチェック             |
| `pnpm run check:types`               | tsc    | コードの型チェック                               |
| `pnpm run check:spells "**/*.ts"`    | CSpell | コードのスペルチェック                           |
| `pnpm run test:develop`              | Vitest | ユニットテストを実行して、コードの品質をチェック |

これらの品質チェック用スクリプトは、開発中に随時実行できます。

### 9.3 全体実行 (`monorepo`ルート)

複数のパッケージを横断的にチェックしたい場合は、リポジトリのルート (`monorepo`ルート) で以下のコマンドを実行します。

<!-- markdownlint-disable line-length -->

| 実行スクリプト           | ツール     | チェック内容                                                  | 備考                                          |
| ------------------------ | ---------- | ------------------------------------------------------------- | --------------------------------------------- |
| `pnpm run lint`          | ESLint     | `pnpm -r run lint` を内部で実行。すべてのサブパッケージを対象 |                                               |
| `pnpm run format:dprint` | dprint     | コードやドキュメントの書式整形                                | `check:dprint` を使えば整形チェックのみ可能   |
| `pnpm run lint-all`      | ESLint     | 全ソースコードを対象にした静的解析                            | lefthook により `pre-commit` で自動実行される |
| `pnpm run lint:secrets`  | Secretlint | ソースコードや設定ファイル内の機密情報をスキャン              | lefthook により `pre-commit` で自動実行される |
| `pnpm run lint:filename` | ls-lint    | ファイル／ディレクトリの命名規則チェック                      | kebab-case など命名ルールの統一を確認         |

<!-- markdownlint-enable -->

### 9.4 ドキュメントの品質チェック

ドキュメント作成時には、以下のコマンドを実行してドキュメントの品質をチェックできます。

| 実行スクリプト                          | ツール            | チェック内容                                     | 備考 |
| --------------------------------------- | ----------------- | ------------------------------------------------ | ---- |
| `pnpm run lint:text "docs/**/*.md"`     | textlint          | ドキュメントを文体や記述ガイドラインに基づき検証 |      |
| `pnpm run lint:markdown "docs/**/*.md"` | markdownlint-cli2 | ドキュメントのマークダウンの文法チェック         |      |

> 💡 Visual Studio Code (VSCode) などのエディタには、対応ツール用の拡張機能が提供されています。
> これらのツールを用いることで、フィードバックを得ながらの開発が可能です。

### 9.5 Gitフック連携による自動品質チェック

本プロジェクトでは、Lefthook を使用して Git フックと連携しています。
プロジェクトルートにある`lefthook.yml`により、自動的に品質チェックを行います。

<!-- markdownlint-disable line-length -->

| Lefthook コマンド | ツール     | チェック内容                               | 備考                                                         |
| ----------------- | ---------- | ------------------------------------------ | ------------------------------------------------------------ |
| `gitleaks`        | Gitleaks   | 機密情報の漏洩チェック                     | 機密情報の詳細は、`/configs/gitleaks.toml`で設定             |
| `secretlint`      | Secretlint | 機密情報の漏洩チェック                     |                                                              |
| `eslint`          | ESLint     | コードの静的解析によるエラーチェック       | `pnpm run lint-all`を使用                                    |
| `eslint-types`    | ESLint     | コードの静的解析による型チェック           | `pnpm run lint-all:types`を使用                              |
| `lint-files`      | ls-lint    | ファイル／ディレクトリの命名規則チェック   | ディレクトリが`kebab-case`などの命名規則に従っているかを検証 |
| `check-spells`    | CSpell     | ドキュメント、ソースコードのスペルチェック |                                                              |

<!-- markdownlint-enable -->

> 💡 コミット前に品質チェックを実行したい場合は、`lefthook run pre-commit` コマンドを使用できます。
> これにより、Git フックに設定されたすべての品質チェックを、コミット前に手動実行できます。

### 9.6 理解度チェック

- [ ] プロジェクトで使われている品質チェックツールの種類と役割を説明できる
- [ ] `tsc` や `ESLint` など、型・静的解析系ツールの違いがわかる
- [ ] `pnpm run` によるローカルチェックと、リポジトリルートでの全体チェックの違いを理解している
- [ ] コードとドキュメント、それぞれに対応する整形・チェックツールを使い分けられる
- [ ] `lefthook` によって Git 操作時にどのようなチェックが実行されるか把握している
