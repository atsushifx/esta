# get-platform パッケージ仕様書

## 概要

`@esta-utils/get-platform`は、クロスプラットフォーム対応のアプリケーション開発において、実行時プラットフォームを判定するためのユーティリティパッケージです。

## 現在の実装状況

### アーキテクチャ

```
src/
├── index.ts           # バレルファイル（エクスポート管理）
├── getPlatform.ts     # メイン機能実装
└── __tests__/
    └── getPlatform.spec.ts  # 単体テスト
```

### 主要機能

#### 1. PlatformType 列挙型

```typescript
enum PlatformType {
  WINDOWS = 'windows',
  LINUX = 'linux',
  MACOS = 'macos',
  UNKNOWN = 0, // falsy値として設計
}
```

#### 2. プラットフォーム判定関数

```typescript
getPlatform(platform?: string, strict?: boolean): PlatformType
```

- デフォルトで`os.platform()`を使用
- strictモード：未対応プラットフォームで例外スロー
- 非strictモード：`PlatformType.UNKNOWN`を返却

#### 3. 個別判定関数

```typescript
isWindows(): boolean
isLinux(): boolean  
isMacOS(): boolean
```

#### 4. PATH区切り文字取得

```typescript
getDelimiter(): string  // Windows: ';', その他: ':'
```

### エクスポート構造

- **名前付きエクスポート**: 個別機能
- **名前空間エクスポート**: `estaUtils`オブジェクト
- **デフォルトエクスポート**: `getPlatform`関数

## 問題点と改善案

### 1. テストカバレッジ不足

**現状**: `getPlatform`関数のみテスト実装

**改善案**:

- `isWindows/isLinux/isMacOS`の個別テスト追加
- `getDelimiter`のテスト追加
- エラーハンドリングのテスト強化

### 2. 型安全性の向上

**現状**:

- `PlatformType.UNKNOWN`がnumber型（0）で他がstring型
- 型の不整合による潜在的バグリスク

**改善案**:

- 全て文字列ベースのunion型に統一
- より型安全なAPIデザイン

### 3. APIの一貫性

**現状**:

- 個別判定関数は内部で`getPlatform()`を呼び出し
- 不要な`os.platform()`の重複実行

**改善案**:

- プラットフォーム情報の一度取得・キャッシュ
- パフォーマンス向上

### 4. 拡張性の制限

**現状**:

- ハードコードされたプラットフォーム対応
- 新しいプラットフォーム追加時の保守性

**改善案**:

- 設定ベースのプラットフォーム定義
- プラグイン機構の検討

## リファクタリング提案

### フェーズ1: 基本改善

1. **テストカバレッジ向上**
   - 全機能の単体テスト追加
   - エッジケースのテスト追加

2. **型安全性向上**
   - `PlatformType`の文字列union型化
   - 型ガードの追加

3. **パフォーマンス改善**
   - プラットフォーム情報のキャッシュ機構

### フェーズ2: アーキテクチャ改善

1. **責任分離**
   - プラットフォーム検出ロジックの分離
   - 設定管理の分離

2. **拡張性向上**
   - プラットフォーム定義の外部化
   - プラグイン機構の実装

3. **エラーハンドリング強化**
   - 詳細なエラー情報の提供
   - 復旧可能なエラーの分類

## 互換性要件

### 破壊的変更の制限

- 既存のpublic APIは維持
- `PlatformType`の値は後方互換性保持
- エクスポート構造は現状維持

### 推奨移行パス

1. 非推奨機能の段階的廃止
2. 新APIへの移行ガイド提供
3. 十分な移行期間の確保

## 品質要件

### テストカバレッジ

- **単体テスト**: 100%カバレッジ
- **統合テスト**: 主要ユースケース
- **E2Eテスト**: 実際のプラットフォーム環境

### パフォーマンス

- **初回実行**: 10ms以内
- **キャッシュ後**: 1ms以内
- **メモリ使用量**: 最小限

### 保守性

- **コード品質**: ESLint/TSルール準拠
- **ドキュメント**: JSDoc完備
- **型定義**: 完全な型情報提供

## 結論

現在の実装は基本機能を満たしていますが、テストカバレッジ、型安全性、拡張性の面で改善の余地があります。段階的なリファクタリングにより、より堅牢で保守しやすいパッケージに改善できます。
