---
title: プロジェクト構成ガイド
description: フィクスチャ・テスト・バリデータのファイル構成とディレクトリ設計のルールを解説します。
sidebar_position: 3
slug: /project-structure
---

## 第3章 プロジェクト構成ガイド

この章では、E2E Fixture Framework を導入する際の**プロジェクト構成ルール**と、推奨されるディレクトリの分け方・命名規則について解説します。

### 1. プロジェクト構成

#### 1.1 推奨ディレクトリ構成

E2E Fixture Framework を利用するプロジェクトでは、**ソースコード・テスト・共通型定義**を明確に分離した構成を推奨します。

```bash
packages/
├── markdown-heading-extractor/
│   ├── src/
│   │   ├── extractor.ts
│   │   └── utils/
│   │       └── normalize.ts
│   ├── tests/
│   │   └── e2e/
│   │       ├── framework.e2e.spec.ts
│   │       └── fixtures/
│   │           └── markdown/
│   │               └── headings/
│   │                   └── h1-case/
│   ├── shared/
│   │   └── types/
│   │       └── index.ts
│   └── README.md
```

この構成により、各ファイルの責任が明確になり、保守性とチーム内の理解が高まります。

> `shared/types` では、このパッケージで共通で使用する型を定義します。 (例:ParsedDocument, ExtractResult
> など、Markdown 抽出処理や構文解析で再利用される型定義)
> 必要なら、定数の定義用に`/shared/constants`も設定します。

#### 1.2 各構成要素の役割

それぞれのディレクトリ／ファイルの役割は次の通りです。

<!-- markdownlint-disable line-length -->

| ディレクトリ / ファイル           | 役割                                                                                 |
| --------------------------------- | ------------------------------------------------------------------------------------ |
| `src/`                            | プロジェクトの主要ロジックを格納。パーサ、抽出器、変換処理などの本体コードを配置     |
| `src/utils/`                      | 共通処理や補助関数をまとめたユーティリティ群。テスト側からも参照されることがある     |
| `tests/e2e/`                      | フィクスチャベースの E2E テストに関連するファイルを格納                              |
| `tests/e2e/framework.e2e.spec.ts` | フレームワーク本体を呼び出し、`runAllFoundTests()` を通じて全フィクスチャを実行する  |
| `tests/e2e/fixtures/`             | 入力ファイルと期待出力ファイルを組み合わせたディレクトリ単位のテストケースを配置     |
| `shared/types/`                   | `ParsedDocument`, `ExtractResult` など、プロジェクト内で再利用される型定義をまとめる |

<!-- markdownlint-enable -->

このように、構成要素ごとに明確な責務を持たせることで、プロジェクト全体の見通しと保守性が向上します。

#### 1.3 命名規則・管理のポイント

E2E Fixtures Framework を導入する際のファイル・ディレクトリ命名において、以下のポイントを意識することで整理と拡張がしやすくなります。

<!-- textlint-disable ja-technical-writing/sentence-length -->

- **処理対象別・用途別にディレクトリ階層で整理する**
  例: `markdown/headings/h1-case/` のように、**大分類 → 小分類 → テストケース** の順に構成することで、視認性と検索性が向上する。

- **テストケースはディレクトリ単位で定義する**
  1ディレクトリに `input.*` + `output.json` をペアで置くことで、1つの明確なテスト単位として管理できる

- **一時的に無効化したいケースは `#` プレフィックスを使う**
  `#drafts/` のように、作業中や一時的に無効化したいディレクトリに`#`を付けることで、`runAllFoundTests()` 実行時にスキップ対象となる。

<!-- textlint-enable -->

> 命名規則と分類ルールを最初に定めておくことで、チーム内での認識の統一や運用の自動化がスムーズになります。

### 2. テスト構成

E2E Fixture Framework のテストは、入力ファイルと出力ファイルのペアによって成立します。
ここでは `fixtures/` 以下におけるテスト構成の基本と、ディレクトリ設計の意味を解説します。

#### 2.1 テスト構成図

以下は、E2E Fixture Framework におけるテストケースの基本構成を示す図です。

```plaintext
fixtures/
  └── markdown/
      └── headings/
          └── h1-case/
              ├── input.md
              └── output.json
```

この 3層構造は、処理内容や対象形式に応じた分類が可能で、大量のテストを整理しやすく、カテゴリ単位での検証や除外が柔軟に行える設計となっています。

- `markdown/`: 主な入力フォーマット
- `headings/`: そのなかでも特定の処理 (見出し抽出など)
- `h1-case/` : 実際のテストケース名 (ファイルペア単位)

#### 2.2 テストケースの構成要素

テストケースは、それぞれ独立したディレクトリで構成され、最低でも以下の 2つのファイルで成り立ちます。

| ファイル名／ディレクトリ名   | 内容                                                                       |
| ---------------------------- | -------------------------------------------------------------------------- |
| `input.md`                   | テスト対象となる入力ファイル。Markdown やテキストなど任意の形式            |
| `output.json`                | 期待される出力。検証対象となる JSON 構造のファイル                         |
| `markdown/`                  | メインカテゴリ: 処理対象 (例: Markdown)                                    |
| `markdown/headings/`         | サブカテゴリ：処理単位 (例: 見出し抽出)                                    |
| `markdown/headings/h1-case/` | テストケース: 個別のテストケース (入力と出力のペア) を格納するディレクトリ |

この構成により、テストケースが視覚的・論理的に整理され、追加・保守・レビューのすべてが容易になります。
ディレクトリ名は、ログや失敗時のケース名として利用され、デバッグ効率にも大きく寄与します。
特に、テスト失敗時にケース名がそのまま表示されるため、原因の特定が迅速になります。

> 1ディレクトリ＝1テストケース という構造は、拡張性と管理性を兼ね備えた E2E テスト運用に非常に適しています。

### まとめ

この章では、ESTA 内の各プロジェクトにおける構成ルールを説明しました。
推奨構成に従うことで、Fixtures テストを円滑に実施できる環境が整います。

- E2E Fixture Framework を活用する際は、**`src/`, `tests/e2e/`, `shared/types/`** などの責任ごとにディレクトリを分離した構成が推奨される
- テストケースは **`fixtures/` 以下を「カテゴリ → サブカテゴリ → ケース」** の 3階層で整理すると、拡張や検索が容易になる
- 各テストケースは **1ディレクトリ＝1ペア（input + output）** で定義し、他と独立した管理が可能
- 一時的に除外したいケースは **`#` をプレフィックスに付ける**ことで、`runAllFoundTests()` による実行から自動的に除外できる
- ディレクトリ構成と命名規則を明確に定義することで、レビュー効率や保守性、CI での自動実行の安定性が大きく向上する

> この構成ルールを守ることで、フィクスチャベースの E2E テストをプロジェクト全体に無理なく導入できます。
> 次章では、実際のフィクスチャの記述方法と設計ポイントを具体的に解説していきます。
