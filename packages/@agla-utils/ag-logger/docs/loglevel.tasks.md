---
header:
  - src: docs/LogLevel-Refactoring.tasks.md
  - "@(#)": ag-logger LogLevel refactoring task list for t-wada style TDD
title: LogLevel リファクタリング タスクリスト
description: t-wada式TDDに基づくag-loggerのLogLevel実装リファクタリング用タスクリスト
version: 1.0.0
created: 2025-07-20
updated: 2025-07-20
authors:
  - Claude（タスク設計・TDD手順策定）
  - atsushifx（要件確認・タスク確定）
changes:
  - 2025-07-20: 初回作成（LogLevel設計書に基づくリファクタリングタスク）
copyright:
  - Copyright (c) 2025 atsushifx <https://github.com/atsushifx>
  - This software is released under the MIT License.
  - https://opensource.org/licenses/MIT
---

## 概要

LogLevel設計書に基づく、現在の実装から推奨アプローチ（数値定数ベース + 部分自動化）への段階的リファクタリングタスク。
t-wada式TDD（テスト駆動開発）に従い、テストファーストで進める。

## テストリスト

### Phase 1: 新実装の基盤準備

#### タスク1-1: 新しい定数定義のテスト

- [ ] `LOG_LEVEL`定数の値検証テスト
- [ ] `LOG_LEVEL`の型安全性テスト
- [ ] 従来の`AgLogLevelCode`との値一致テスト

#### タスク1-2: 文字列→数値変換のテスト

- [ ] `LogLevelFromString`の基本変換テスト
- [ ] 無効な文字列に対するundefined返却テスト
- [ ] 大文字・小文字の扱いテスト
- [ ] 型安全性テスト（keyof制約）

#### タスク1-3: 逆変換の自動生成テスト

- [ ] `LogLevelToString`の自動生成ロジックテスト
- [ ] 数値→文字列変換の正確性テスト
- [ ] `LogLevelFromString`との整合性テスト

### Phase 2: 公開API関数の実装

#### タスク2-1: `getLogLevelFromString`関数のテスト

- [ ] 正常な文字列変換テスト
- [ ] 無効な文字列の処理テスト
- [ ] 型推論の正確性テスト
- [ ] エラーハンドリングテスト

#### タスク2-2: `getLogLevelLabel`関数のテスト

- [ ] 数値から大文字ラベル変換テスト
- [ ] 全ログレベルでの変換テスト
- [ ] 従来の`AgLoggerGetLabel`との一致テスト
- [ ] 無効な数値の処理テスト

### Phase 3: 後方互換性の保証

#### タスク3-1: エイリアス実装のテスト

- [ ] `AgLogLevelCode`エイリアスの動作テスト
- [ ] 既存コードとの互換性テスト
- [ ] 型定義の互換性テスト

#### タスク3-2: 段階的移行のテスト

- [ ] 新旧API並行動作テスト
- [ ] 内部実装切り替えテスト
- [ ] 外部APIの変更なしテスト

### Phase 4: フォーマッター統合

#### タスク4-1: JsonFormatの更新テスト

- [ ] 新`getLogLevelLabel`との統合テスト
- [ ] JSON出力フォーマットの変更なしテスト
- [ ] パフォーマンステスト

#### タスク4-2: PlainFormatの更新テスト

- [ ] 新`getLogLevelLabel`との統合テスト
- [ ] プレーンテキスト出力の変更なしテスト
- [ ] パフォーマンステスト

### Phase 5: 設定ファイル連携

#### タスク5-1: 設定ファイル読み込みテスト

- [ ] JSON設定ファイルからの読み込みテスト
- [ ] YAML設定ファイルからの読み込みテスト
- [ ] 無効な設定値の処理テスト
- [ ] デフォルト値の適用テスト

#### タスク5-2: 設定値検証テスト

- [ ] ログレベル文字列の検証テスト
- [ ] 設定値の型安全性テスト
- [ ] エラーメッセージの適切性テスト

### Phase 6: パフォーマンスと最適化

#### タスク6-1: メモリ使用量テスト

- [ ] 定数定義のメモリ効率テスト
- [ ] オブジェクト生成回数の最適化テスト
- [ ] ガベージコレクション影響テスト

#### タスク6-2: 実行速度テスト

- [ ] ログレベル変換速度のベンチマークテスト
- [ ] 従来実装との速度比較テスト
- [ ] 大量ログ出力時のパフォーマンステスト

### Phase 7: E2E統合テスト

#### タスク7-1: AgLogger統合テスト

- [ ] 新ログレベル実装でのログ出力テスト
- [ ] ログレベルフィルタリングテスト
- [ ] マルチフォーマット出力テスト

#### タスク7-2: 実際の使用ケーステスト

- [ ] GitHub Actions環境での動作テスト
- [ ] 設定ファイル経由でのログレベル設定テスト
- [ ] 実際のアプリケーション統合テスト

## 実装ステップ

### Step 1: テストファイル作成

各Phaseのテストケースに対応するテストファイルを作成:

- `src/shared/types/__tests__/LogLevel.new.spec.ts`
- `src/utils/__tests__/LogLevelHelpers.new.spec.ts`
- `src/plugins/format/__tests__/Format.integration.spec.ts`

### Step 2: Red フェーズ

テストを実行し、失敗することを確認（テスト対象がまだ存在しない）

### Step 3: Green フェーズ

最小限の実装でテストを通す:

1. 新しい定数定義
2. 変換関数の実装
3. 公開API関数の実装

### Step 4: Refactor フェーズ

コードの改善とリファクタリング:

1. 型定義の最適化
2. パフォーマンスの改善
3. コードの可読性向上

### Step 5: 統合と移行

1. 既存コードの段階的移行
2. 非推奨API（`AgLogLevelLabels`）の削除準備
3. ドキュメントの更新

## 完了条件

- [ ] 全テストケースがpass
- [ ] 既存の公開APIに破壊的変更なし
- [ ] パフォーマンスが従来実装以上
- [ ] 型安全性の向上
- [ ] 設定ファイル連携の簡素化
- [ ] コードカバレッジ95%以上
- [ ] ドキュメントの更新完了

## 注意事項

- 各タスクは小さなステップで進める
- テストファーストを厳守
- 既存APIの破壊的変更は避ける
- パフォーマンスの劣化は許可しない
- 型安全性を最優先とする
